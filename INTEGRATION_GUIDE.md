# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –≤—ã–≤–æ–¥–∞ –∑–≤–µ–∑–¥

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—ã–≤–æ–¥–∏—Ç—å –∑–≤–µ–∑–¥—ã –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –±–æ—Ç–∞ Telegram. –ü—Ä–æ—Ü–µ—Å—Å –≤–∫–ª—é—á–∞–µ—Ç:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ API
3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∑–∞—è–≤–∫—É –≤ –±–æ—Ç–µ
4. –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å –≤ –±–æ—Ç–µ

## API Endpoints

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥

**POST** `/api/withdrawal/create`

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
    "user_id": 123456789,
    "amount": 100,
    "app_transaction_id": "app_tx_12345",
    "signature": "hmac_signature_here",
    "notes": "–í—ã–≤–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ
- `amount` (int, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –°—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö
- `app_transaction_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- `signature` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - HMAC –ø–æ–¥–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏
- `notes` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ:**
```json
{
    "success": true,
    "withdrawal_id": 42,
    "message": "–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```json
{
    "success": false,
    "error": "error_code",
    "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏

**GET** `/api/withdrawal/status/{withdrawal_id}`

**–û—Ç–≤–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ:**
```json
{
    "success": true,
    "withdrawal_id": 42,
    "user_id": 123456789,
    "amount": 100,
    "status": "pending",
    "app_transaction_id": "app_tx_12345",
    "created_at": "2024-01-01 12:00:00",
    "updated_at": "2024-01-01 12:00:00",
    "notes": "–í—ã–≤–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- `pending` - –û–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è
- `approved` - –û–¥–æ–±—Ä–µ–Ω–∞ (—Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞—á–∏—Å–ª–µ–Ω—ã)
- `rejected` - –û—Ç–∫–ª–æ–Ω–µ–Ω–∞
- `completed` - –í—ã–ø–æ–ª–Ω–µ–Ω–∞

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HMAC –ø–æ–¥–ø–∏—Å–∏

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å HMAC –ø–æ–¥–ø–∏—Å—å.

### –ê–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä–æ–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è: `{user_id}:{amount}:{app_transaction_id}`
2. –í—ã—á–∏—Å–ª–∏—Ç–µ HMAC-SHA256: `HMAC(secret_key, message, SHA256)`
3. –ü—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ –≤ hex-—Å—Ç—Ä–æ–∫—É

### –ü—Ä–∏–º–µ—Ä –Ω–∞ Python:

```python
import hmac
import hashlib

def generate_signature(user_id, amount, app_transaction_id, secret_key):
    message = f"{user_id}:{amount}:{app_transaction_id}"
    signature = hmac.new(
        secret_key.encode('utf-8'),
        message.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    return signature

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
user_id = 123456789
amount = 100
app_transaction_id = "app_tx_12345"
secret_key = "your_secret_key_here"

signature = generate_signature(user_id, amount, app_transaction_id, secret_key)
```

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ –æ—à–∏–±–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `missing_field` | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ |
| `invalid_user_id` | –ù–µ–≤–µ—Ä–Ω—ã–π user_id |
| `invalid_amount` | –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ |
| `invalid_transaction_id` | –ù–µ–≤–µ—Ä–Ω—ã–π app_transaction_id |
| `invalid_json` | –ù–µ–≤–µ—Ä–Ω—ã–π JSON |
| `invalid_signature` | –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å |
| `user_not_found` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| `duplicate_transaction` | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| `withdrawal_not_found` | –ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ |
| `internal_error` | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

## –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Python (aiohttp):

```python
import aiohttp
import hmac
import hashlib
import json

async def create_withdrawal(user_id, amount, app_transaction_id, secret_key):
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å—å
    message = f"{user_id}:{amount}:{app_transaction_id}"
    signature = hmac.new(
        secret_key.encode('utf-8'),
        message.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    data = {
        "user_id": user_id,
        "amount": amount,
        "app_transaction_id": app_transaction_id,
        "signature": signature,
        "notes": "–í—ã–≤–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    }
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    async with aiohttp.ClientSession() as session:
        async with session.post(
            "http://your-bot-server:8080/api/withdrawal/create",
            json=data,
            headers={"Content-Type": "application/json"}
        ) as response:
            result = await response.json()
            return result
```

### JavaScript (fetch):

```javascript
const crypto = require('crypto');

async function createWithdrawal(userId, amount, appTransactionId, secretKey) {
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å—å
    const message = `${userId}:${amount}:${appTransactionId}`;
    const signature = crypto
        .createHmac('sha256', secretKey)
        .update(message)
        .digest('hex');
    
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const data = {
        user_id: userId,
        amount: amount,
        app_transaction_id: appTransactionId,
        signature: signature,
        notes: "–í—ã–≤–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    };
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    const response = await fetch('http://your-bot-server:8080/api/withdrawal/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });
    
    const result = await response.json();
    return result;
}
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ –≤ –±–æ—Ç–µ:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/admin` –≤ –±–æ—Ç–µ
2. –í—ã–±–µ—Ä–∏—Ç–µ "üì± –í—ã–≤–æ–¥—ã –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞—è–≤–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π

### –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞—è–≤–∫–∞–º–∏:

- **‚úÖ –û–¥–æ–±—Ä–∏—Ç—å** - –ù–∞—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ
- **‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å** - –û—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞—è–≤–∫—É —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
- **‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ** - –û—Ç–º–µ—á–∞–µ—Ç –∑–∞—è–≤–∫—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **HMAC –ø–æ–¥–ø–∏—Å–∏** - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∞–ª–∏–¥–Ω—É—é –ø–æ–¥–ø–∏—Å—å
2. **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** - –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **HTTPS** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
- user_id
- amount
- app_transaction_id
- withdrawal_id
- timestamp

### –ú–µ—Ç—Ä–∏–∫–∏:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **"invalid_signature"** - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏
2. **"user_not_found"** - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –±–æ—Ç–µ
3. **"duplicate_transaction"** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ app_transaction_id
4. **"invalid_amount"** - –°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ endpoint `/api/withdrawal/status/{withdrawal_id}` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏.

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –±–æ—Ç–∞
